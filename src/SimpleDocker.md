# SimpleDocker:

----------------------------------------------------------------------------

- [SimpleDocker:](#SimpleDocker)
    - [1. Готовый докер:](#1-готовый-докер)
    - [2. Операции с контейнером:](#2-операции-с-контейнером)
    - [3. Мини веб-сервер:](#3-мини-веб-сервер)
    - [4. Свой докер:](#4-свой-докер)
    - [5. Dockle:](#5-dockle)
    - [6. Базовый Docker Compose:](#6-базовый-docker-compose)

----------------------------------------------------------------------------

## 1. Готовый докер:
- Установил **docker** и **docker desktop** на **ОС Windows 11 v. 23H2**.

> Версия **docker**:
>
> ![Версия](screen%2Fscreen_1_01.png)
>

- Выкачал официальный докер-образ с **nginx** при помощи команды `docker pull nginx`.

> Скачивание докер-образа с **nginx**:
>
> ![Скачивание докер-образа с nginx](screen%2Fscreen_1_02.png)
>

- Проверил наличие докер-образа через команду `docker images`.

> Список скачанных докер-образов:
>
> ![Список скачанных докер-образов](screen%2Fscreen_1_03.png)
>

- Запустил докер-образ командой `docker run -d [IMAGE_ID]`.

> Запуск докер-образа:
>
> ![Запуск докер-образа](screen%2Fscreen_1_04.png)
>

- Проверил запуск образа командой `docker ps`.

> Список запущенных контейнеров:
>
> ![Список запущенных контейнеров](screen%2Fscreen_1_05.png)
>

- Отобразил информацию о контейнере командой `docker inspect [CONTAINER_ID]`.

> Вывод информации о контейнере:
>
> ![Информация о контейнере](screen%2Fscreen_1_06.png)
>

- Описание контейнера:
  - размер контейнера: 64 MB
  - замапленый порт: 80
  - ip контейнера: 172.17.0.2

> Размер контейнера (shared memory):
>
> ![Размер контейнера](screen%2Fscreen_1_07.png)
>
> Значение **"ShmSize"** составляет **67,108,864 байт**, что эквивалентно **64 MB**. Это стандартный размер по умолчанию для Docker-контейнеров.
> 

> Замапленый порт:
>
> ![Замапленый порт](screen%2Fscreen_1_08.png)
>
> **Замапленный (от англ. "mapped") порт** который сопоставлен с портом на хост-машине (той, на которой запущен Docker). Процесс маппинга позволяет перенаправить сетевой трафик с определенного порта хост-машины на соответствующий порт внутри контейнера.
> 

> ip контейнера:
>
> ![ip контейнера](screen%2Fscreen_1_09.png)
>
> **172.17.0.2** — это уникальный адрес данного контейнера внутри сети **Docker**.
> 

- Остановил докер контейнер командой `docker stop [CONTAINER_ID]`.
- Поверил, что контейнер остановился командой `docker ps`

> Остановка контейнера:
>
> ![Остановка контейнер](screen%2Fscreen_1_10.png)
>

- Запустил докер с портами **80** и **443** в контейнере, замапленными на такие же порты на локальной машине командой `docker run -d -p 80:80 -p 443:443 nginx`.
- Проверил запуск образа командой `docker ps`.

> Успешный запуск контейнера с портами 80 и 443:
>
> ![Успешный запуск контейнера с портами 80 и 443](screen%2Fscreen_1_11.png)
>

- Перешёл в браузере по адресу **localhost:80**.

> Стартовая страница **nginx**:
>
> ![Стартовая страница nginx](screen%2Fscreen_1_12.png)
>

- Перезапустил докер контейнер командой `docker restart [CONTAINER_ID]`.
- Проверил перезапуск контейнера командой `docker ps`.

> Успешный перезапуск контейнера:
>
> ![Успешный перезапуск контейнера](screen%2Fscreen_1_13.png)
>

----------------------------------------------------------------------------

## 2. Операции с контейнером:

- Отобразил конфигурационный файл `nginx.conf` внутри докер контейнера с помощью команды `docker exec -it [CONTAINER_ID] cat /etc/nginx/nginx.conf`.

> Конфигурационный файл nginx.conf:
>
> ![Конфигурационный файл nginx.conf](screen%2Fscreen_2_01.png)
>
> `docker exec` : используется для выполнения команды внутри запущенного Docker-контейнера.
>
> `-i` (interactive): означает, что команда должна работать в интерактивном режиме.
>
> `-t` (tty): создает терминал для взаимодействия.
> 

```nginx
user  nginx;  # Пользователь, от имени которого будут запущены процессы Nginx.
worker_processes  auto;  # Количество процессов рабочих Nginx. "auto" означает, что Nginx автоматически выберет оптимальное число рабочих процессов (обычно равно числу ядер процессора).

error_log  /var/log/nginx/error.log notice;  # Путь к файлу журнала ошибок и уровень логирования (здесь "notice" — логирование уведомлений).
pid        /var/run/nginx.pid;  # Путь к файлу с PID (идентификатор процесса) основного процесса Nginx.

events {
    worker_connections  1024;  # Максимальное количество одновременных соединений, которые каждый процесс-работник может обрабатывать.
}

http {
    include       /etc/nginx/mime.types;  # Подключает файл с типами MIME для определения типа контента.
    default_type  application/octet-stream;  # Тип контента по умолчанию, если не удалось определить MIME-тип (octet-stream используется для бинарных файлов).

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';  # Определяет формат записи журнала доступа. Каждый запрос логируется с информацией о клиенте, запросе, статусе и др.

    access_log  /var/log/nginx/access.log  main;  # Путь к файлу журнала доступа с использованием формата "main", описанного выше.

    sendfile        on;  # Включает использование системной функции sendfile(), что ускоряет передачу файлов через сеть.
    #tcp_nopush     on;  # Комментарий: эта опция может использоваться для оптимизации передачи данных, но она выключена по умолчанию.

    keepalive_timeout  65;  # Время (в секундах), в течение которого соединение будет поддерживаться открытым для последующих запросов.

    #gzip  on;  # Комментарий: эта строка включает сжатие Gzip для уменьшения объема передаваемых данных, но оно отключено по умолчанию.

    include /etc/nginx/conf.d/*.conf;  # Включает все конфигурационные файлы из директории "/etc/nginx/conf.d/". Обычно это виртуальные хосты и дополнительные настройки.
}
```

- Создал файл `nginx.conf` на хостовой машине, скопировав туда изначальные настройки конфигурации и добавив в него параметры отдачи страницы статуса сервера **nginx** по пути `/status`.

> Модифицированный файл `nginx.conf`:
>
> ![Модифицированный файл nginx.conf](screen%2Fscreen_2_02.png)
>

```nginx
# Добавленые строки
    server {
        listen 80;  # Установка порта для прослушивания запросов
        server_name localhost;  # Имя сервера (можно заменить на свой домен или IP)

        location /status {
           stub_status on;  # Включение страницы статуса Nginx.
           allow all;  # Разрешение доступа ко всем на страницу статуса.
       }
   }
}
```

- Скопировал файл конфигурации `nginx.conf` внутрь докер контейнера, командой `docker cp ./nginx.conf [CONTAINER_ID]:/etc/nginx/nginx.conf`.

> Копирование файла `nginx.conf`:
>
> ![Копирование файла nginx.conf](screen%2Fscreen_2_03.png)
>

- Перезапустил сервер **nginx** внутри докер контейнера командой `docker exec -it [CONTAINER_ID] nginx -s reload`.

> Перезапуск сервера **nginx**:
>
> Флаг `-s` позволяет применить новые настройки без остановки самого процесса nginx.
> 
> ![Перезапуск сервера nginx](screen%2Fscreen_2_04.png)
>
> Сообщение об ошибке предупреждает, что есть конфликты с именем сервера `localhost`, так как оно уже используется на порту `0.0.0.0:80`. Это значит, что в конфигурации **nginx** уже существует другой сервер, который прослушивает этот порт с таким же именем.
> 

- Проверил наличие других конфигурационных файлов **nginx** внутри докер контейнера командами `docker exec -it [CONTAINER_ID] ls /etc/nginx/` и `docker exec -it [CONTAINER_ID] ls /etc/nginx/conf.d`.

> Директория с файлами конфигурации **nginx**:
>
> ![Директория с файлами конфигурации nginx](screen%2Fscreen_2_05.png)
>

- Отобразил дефолтный конфигурационный файл **nginx** `default.conf`  с помощью команды `docker exec -it [CONTAINER_ID] cat /etc/nginx/conf.d/default.conf`.

> Дефолтный файл конфигурации **nginx**:
>
> ![Дефолтный файл конфигурации nginx](screen%2Fscreen_2_06.png)
>
> Из вывода видно, что по умолчанию конфигурация **nginx** в контейнере уже прослушивает порт `80` и использует `server_name localhost`. Это и вызывает конфликт при попытке загрузить другую конфигурацию на тот же порт и серверное имя.
>

- Удалил конфигурационный файл `default.conf`  с помощью команды `docker exec -it [CONTAINER_ID] rm /etc/nginx/conf.d/default.conf`.

> Удаление файла `default.conf`:
>
> ![Удаление файла default.conf](screen%2Fscreen_2_07.png)
>

- Перезапустил сервер **nginx** внутри докер контейнера командой `docker exec -it [CONTAINER_ID] nginx -s reload`.

> Перезапуск сервера **nginx**:
>
> ![Перезапуск сервера nginx](screen%2Fscreen_2_08.png)
>

- Перешёл в браузере по адресу **localhost:80/status**.

> Страничка со статусом сервера **nginx**:
>
> ![Страничка со статусом сервера nginx](screen%2Fscreen_2_09.png)
>

- Экспортировал контейнер в файл `container.tar` командой `docker export [CONTAINER_ID] -o container.tar`.

> Экспортирование контейнера в файл:
>
> ![Экспортирование контейнера в файл](screen%2Fscreen_2_10.png)
>

- Остановил контейнер командой `docker stop [CONTAINER_ID]`.

> Остановка контейнера:
>
> ![Остановка контейнера](screen%2Fscreen_2_11.png)
>

- Удалил образ командой `docker rmi -f [IMAGE_ID]`, не удаляя перед этим контейнеры.

> Удаление образа:
>
> ![Удаление образа](screen%2Fscreen_2_12.png)
>
> Флаг `-f` позволит принудительно удалить образ. Без него система не даст удалить образ, при существующем остановленным контейнером, который использует этот образ.
>

- Проверил, что образ удалился командой `docker images`.

> Список доступных докер-образов:
>
> ![Список доступных докер-образов](screen%2Fscreen_2_13.png)
>

- Удалил докер контейнер командой `docker rm [CONTAINER_ID]`.

> Удаление докер контейнера:
>
> ![Удаление докер контейнера](screen%2Fscreen_2_14.png)
>

- Проверил, что контейнер удалился командой `docker ps -a`.

> Список всех докер контейнеров:
>
> ![Список всех докер контейнеров](screen%2Fscreen_2_15.png)
>
> Флаг `-a` отображает остановленные контейнеры.
> 

- Импортировал контейнер обратно командой `docker import container.tar [NEW_NAME_IMAGE]`.
- Проверил, что контейнер импортировался командой `docker images`.

> Импортирование контейнера:
>
> ![Импортирование контейнера](screen%2Fscreen_2_16.png)
>

- Попробовал запустить импортированный контейнер командой `docker run -d -p 80:80 -p 443:443 [IMAGE_ID]`.

> Запуск импортированного контейнера:
>
> ![Запуск импортированного контейнера](screen%2Fscreen_2_17.png)
>
> Ошибка `no command specified` возникает, потому что при создании образа с помощью команды `docker import`, **docker** не сохраняет команду, которую необходимо выполнить по умолчанию при запуске контейнера.
> 
> Официальный образ **nginx** уже настроен для работы "из коробки". В нём заранее указана команда для запуска **nginx** при создании контейнера, поэтому, когда запускается контейнер с официальным образом, он сразу стартует веб-сервер **nginx** без дополнительных указаний.
> 
> **Импортированный образ** (который мы создали через `docker import`) не содержит данных о том, какую команду выполнять при старте контейнера.
>

- Запустил импортированный контейнер, явно указав команду, которую контейнер должен выполнить `docker run -d -p 80:80 -p 443:443 8e1e9b36c054 nginx -g 'daemon off;'`.
- Проверил запуск контейнера командой `docker ps`.

> Успешный запуск импортированного контейнера:
>
> ![Успешный запуск импортированного контейнера](screen%2Fscreen_2_18.png)
>
> Флаг `-g` : используется для передачи глобальных директив напрямую в конфигурацию **nginx** из командной строки.
> 
> `'daemon off;'` : отключает работу **nginx** в фоновом режиме (демонизацию) и говорит работать на переднем плане, что требуется для контейнера **docker**.
>

- Проверил, что по адресу **localhost:80/status** отдается страничка со статусом сервера **nginx**.

> Страничка со статусом сервера **nginx**:
>
> ![Страничка со статусом сервера nginx](screen%2Fscreen_2_19.png)
>

----------------------------------------------------------------------------

## 3. Мини веб-сервер:

----------------------------------------------------------------------------

## 4. Свой докер:

----------------------------------------------------------------------------

## 5. Dockle:

----------------------------------------------------------------------------

## 6. Базовый Docker Compose:

----------------------------------------------------------------------------